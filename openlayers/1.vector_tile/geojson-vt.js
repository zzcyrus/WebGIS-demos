!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).geojsonvt=e()}}(function(){return function e(t,n,r){function o(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return o(n||e)},f,f.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";function r(e,t,n,r,o){return t.length&&(t.area=n,t.dist=r,void 0!==o&&(t.outer=o),e.push(t)),[]}t.exports=function(e,t,n,i,s,u,l,a){if(n/=t,i/=t,l>=n&&a<=i)return e;if(l>i||a<n)return null;for(var f=[],h=0;h<e.length;h++){var p,m,c=e[h],d=c.geometry,g=c.type;if(p=c.min[s],m=c.max[s],p>=n&&m<=i)f.push(c);else if(!(p>i||m<n)){var v=1===g?function(e,t,n,r){for(var o=[],i=0;i<e.length;i++){var s=e[i],u=s[r];u>=t&&u<=n&&o.push(s)}return o}(d,n,i,s):function(e,t,n,o,i,s){for(var u=[],l=0;l<e.length;l++){var a,f,h,p=0,m=0,c=null,d=e[l],g=d.area,v=d.dist,x=d.outer,y=d.length,M=[];for(f=0;f<y-1;f++)a=c||d[f],c=d[f+1],p=m||a[o],m=c[o],p<t?m>n?(M.push(i(a,c,t),i(a,c,n)),s||(M=r(u,M,g,v,x))):m>=t&&M.push(i(a,c,t)):p>n?m<t?(M.push(i(a,c,n),i(a,c,t)),s||(M=r(u,M,g,v,x))):m<=n&&M.push(i(a,c,n)):(M.push(a),m<t?(M.push(i(a,c,t)),s||(M=r(u,M,g,v,x))):m>n&&(M.push(i(a,c,n)),s||(M=r(u,M,g,v,x))));a=d[y-1],(p=a[o])>=t&&p<=n&&M.push(a),h=M[M.length-1],s&&h&&(M[0][0]!==h[0]||M[0][1]!==h[1])&&M.push(M[0]),r(u,M,g,v,x)}return u}(d,n,i,s,u,3===g);v.length&&f.push(o(c.tags,g,v,c.id))}}return f.length?f:null};var o=e("./feature")},{"./feature":3}],2:[function(e,t,n){"use strict";function r(e,t,n){if(null!==t.geometry){var s,l,a,f,h=t.geometry,p=h.type,m=h.coordinates,c=t.properties,d=t.id;if("Point"===p)e.push(u(c,1,[i(m)],d));else if("MultiPoint"===p)e.push(u(c,1,o(m),d));else if("LineString"===p)e.push(u(c,2,[o(m,n)],d));else if("MultiLineString"===p||"Polygon"===p){for(a=[],s=0;s<m.length;s++)f=o(m[s],n),"Polygon"===p&&(f.outer=0===s),a.push(f);e.push(u(c,"Polygon"===p?3:2,a,d))}else if("MultiPolygon"===p){for(a=[],s=0;s<m.length;s++)for(l=0;l<m[s].length;l++)(f=o(m[s][l],n)).outer=0===l,a.push(f);e.push(u(c,3,a,d))}else{if("GeometryCollection"!==p)throw new Error("Input data is not a valid GeoJSON object.");for(s=0;s<h.geometries.length;s++)r(e,{geometry:h.geometries[s],properties:c},n)}}}function o(e,t){for(var n=[],r=0;r<e.length;r++)n.push(i(e[r]));return t&&(s(n,t),function(e){for(var t,n,r=0,o=0,i=0;i<e.length-1;i++)t=n||e[i],n=e[i+1],r+=t[0]*n[1]-n[0]*t[1],o+=Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1]);e.area=Math.abs(r/2),e.dist=o}(n)),n}function i(e){var t=Math.sin(e[1]*Math.PI/180),n=e[0]/360+.5,r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r=r<0?0:r>1?1:r,[n,r,0]}t.exports=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)r(n,e.features[o],t);else"Feature"===e.type?r(n,e,t):r(n,{geometry:e},t);return n};var s=e("./simplify"),u=e("./feature")},{"./feature":3,"./simplify":5}],3:[function(e,t,n){"use strict";function r(e,t,n){for(var r,o=0;o<n.length;o++)r=n[o],e[0]=Math.min(r[0],e[0]),t[0]=Math.max(r[0],t[0]),e[1]=Math.min(r[1],e[1]),t[1]=Math.max(r[1],t[1])}t.exports=function(e,t,n,o){var i={id:o||null,type:t,geometry:n,tags:e||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(e){var t=e.geometry,n=e.min,o=e.max;if(1===e.type)r(n,o,t);else for(var i=0;i<t.length;i++)r(n,o,t[i])}(i),i}},{}],4:[function(e,t,n){"use strict";function r(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;n&&console.time("preprocess data");var r=1<<t.maxZoom,o=l(e,t.tolerance/(r*t.extent));this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(o=h(o,t.buffer/t.extent,i)).length&&this.splitTile(o,0,0,0),n&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function o(e,t,n){return 32*((1<<e)*n+t)+e}function i(e,t,n){return[n,(n-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function s(e,t,n){return[(n-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],n,1]}function u(e,t,n){var r=e.source;if(1!==r.length)return!1;var o=r[0];if(3!==o.type||o.geometry.length>1)return!1;var i=o.geometry[0].length;if(5!==i)return!1;for(var s=0;s<i;s++){var u=a.point(o.geometry[0][s],t,e.z2,e.x,e.y);if(u[0]!==-n&&u[0]!==t+n||u[1]!==-n&&u[1]!==t+n)return!1}return!0}t.exports=function(e,t){return new r(e,t)};var l=e("./convert"),a=e("./transform"),f=e("./clip"),h=e("./wrap"),p=e("./tile");r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},r.prototype.splitTile=function(e,t,n,r,l,a,h){for(var m=[e,t,n,r],c=this.options,d=c.debug,g=null;m.length;){r=m.pop(),n=m.pop(),t=m.pop(),e=m.pop();var v=1<<t,x=o(t,n,r),y=this.tiles[x],M=t===c.maxZoom?0:c.tolerance/(v*c.extent);if(!y&&(d>1&&console.time("creation"),y=this.tiles[x]=p(e,v,n,r,M,t===c.maxZoom),this.tileCoords.push({z:t,x:n,y:r}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,y.numFeatures,y.numPoints,y.numSimplified),console.timeEnd("creation"));var P="z"+t;this.stats[P]=(this.stats[P]||0)+1,this.total++}if(y.source=e,l){if(t===c.maxZoom||t===l)continue;var b=1<<l-t;if(n!==Math.floor(a/b)||r!==Math.floor(h/b))continue}else if(t===c.indexMaxZoom||y.numPoints<=c.indexMaxPoints)continue;if(c.solidChildren||!u(y,c.extent,c.buffer)){y.source=null,d>1&&console.time("clipping");var w,Z,z,E,S,C,F=.5*c.buffer/c.extent,O=.5-F,T=.5+F,j=1+F;w=Z=z=E=null,S=f(e,v,n-F,n+T,0,i,y.min[0],y.max[0]),C=f(e,v,n+O,n+j,0,i,y.min[0],y.max[0]),S&&(w=f(S,v,r-F,r+T,1,s,y.min[1],y.max[1]),Z=f(S,v,r+O,r+j,1,s,y.min[1],y.max[1])),C&&(z=f(C,v,r-F,r+T,1,s,y.min[1],y.max[1]),E=f(C,v,r+O,r+j,1,s,y.min[1],y.max[1])),d>1&&console.timeEnd("clipping"),e.length&&(m.push(w||[],t+1,2*n,2*r),m.push(Z||[],t+1,2*n,2*r+1),m.push(z||[],t+1,2*n+1,2*r),m.push(E||[],t+1,2*n+1,2*r+1))}else l&&(g=t)}return g},r.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,s=r.debug,l=1<<e,f=o(e,t=(t%l+l)%l,n);if(this.tiles[f])return a.tile(this.tiles[f],i);s>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var h,p=e,m=t,c=n;!h&&p>0;)p--,m=Math.floor(m/2),c=Math.floor(c/2),h=this.tiles[o(p,m,c)];if(!h||!h.source)return null;if(s>1&&console.log("found parent tile z%d-%d-%d",p,m,c),u(h,i,r.buffer))return a.tile(h,i);s>1&&console.time("drilling down");var d=this.splitTile(h.source,p,m,c,e,t,n);if(s>1&&console.timeEnd("drilling down"),null!==d){var g=1<<e-d;f=o(d,Math.floor(t/g),Math.floor(n/g))}return this.tiles[f]?a.tile(this.tiles[f],i):null}},{"./clip":1,"./convert":2,"./tile":6,"./transform":7,"./wrap":8}],5:[function(e,t,n){"use strict";t.exports=function(e,t){var n,r,o,i,s=t*t,u=0,l=e.length-1,a=[];for(e[u][2]=1,e[l][2]=1;l;){for(r=0,n=u+1;n<l;n++)(o=function(e,t,n){var r=t[0],o=t[1],i=n[0],s=n[1],u=e[0],l=e[1],a=i-r,f=s-o;if(0!==a||0!==f){var h=((u-r)*a+(l-o)*f)/(a*a+f*f);h>1?(r=i,o=s):h>0&&(r+=a*h,o+=f*h)}return a=u-r,f=l-o,a*a+f*f}(e[n],e[u],e[l]))>r&&(i=n,r=o);r>s?(e[i][2]=r,a.push(u),a.push(i),u=i):(l=a.pop(),u=a.pop())}}},{}],6:[function(e,t,n){"use strict";t.exports=function(e,t,n,r,o,i){for(var s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z2:t,transformed:!1,min:[2,1],max:[-1,0]},u=0;u<e.length;u++){s.numFeatures++,function(e,t,n,r){var o,i,s,u,l=t.geometry,a=t.type,f=[],h=n*n;if(1===a)for(o=0;o<l.length;o++)f.push(l[o]),e.numPoints++,e.numSimplified++;else for(o=0;o<l.length;o++)if(s=l[o],r||!(2===a&&s.dist<n||3===a&&s.area<h)){var p=[];for(i=0;i<s.length;i++)u=s[i],(r||u[2]>h)&&(p.push(u),e.numSimplified++),e.numPoints++;3===a&&function(e,t){(function(e){for(var t,n,r=0,o=0,i=e.length,s=i-1;o<i;s=o++)t=e[o],n=e[s],r+=(n[0]-t[0])*(t[1]+n[1]);return r})(e)<0===t&&e.reverse()}(p,s.outer),f.push(p)}else e.numPoints+=s.length;if(f.length){var m={geometry:f,type:a,tags:t.tags||null};null!==t.id&&(m.id=t.id),e.features.push(m)}}(s,e[u],o,i);var l=e[u].min,a=e[u].max;l[0]<s.min[0]&&(s.min[0]=l[0]),l[1]<s.min[1]&&(s.min[1]=l[1]),a[0]>s.max[0]&&(s.max[0]=a[0]),a[1]>s.max[1]&&(s.max[1]=a[1])}return s}},{}],7:[function(e,t,n){"use strict";function r(e,t,n,r,o){return[Math.round(t*(e[0]*n-r)),Math.round(t*(e[1]*n-o))]}n.tile=function(e,t){if(e.transformed)return e;var n,o,i,s=e.z2,u=e.x,l=e.y;for(n=0;n<e.features.length;n++){var a=e.features[n],f=a.geometry;if(1===a.type)for(o=0;o<f.length;o++)f[o]=r(f[o],t,s,u,l);else for(o=0;o<f.length;o++){var h=f[o];for(i=0;i<h.length;i++)h[i]=r(h[i],t,s,u,l)}}return e.transformed=!0,e},n.point=r},{}],8:[function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0;r<e.length;r++){var i,u=e[r],l=u.type;if(1===l)i=o(u.geometry,t);else{i=[];for(var a=0;a<u.geometry.length;a++)i.push(o(u.geometry[a],t))}n.push(s(u.tags,l,i,u.id))}return n}function o(e,t){var n=[];n.area=e.area,n.dist=e.dist;for(var r=0;r<e.length;r++)n.push([e[r][0]+t,e[r][1],e[r][2]]);return n}var i=e("./clip"),s=e("./feature");t.exports=function(e,t,n){var o=e,s=i(e,1,-1-t,t,0,n,-1,2),u=i(e,1,1-t,2+t,0,n,-1,2);return(s||u)&&(o=i(e,1,-t,1+t,0,n,-1,2)||[],s&&(o=r(s,1).concat(o)),u&&(o=o.concat(r(u,-1)))),o}},{"./clip":1,"./feature":3}]},{},[4])(4)});